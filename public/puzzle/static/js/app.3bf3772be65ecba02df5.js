webpackJsonp([1],[,,,,,,,,,,,,function(t,e,i){i(42);var n=i(4)(i(33),i(50),null,null);t.exports=n.exports},,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(13),s=i(12),r=i.n(s);n.a.config.productionTip=!1,new n.a({el:"#app",template:"<App/>",components:{App:r.a}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(46),s=i.n(n),r=i(36),o=i.n(r);e.default={name:"app",components:{Board:s.a},created:function(){this.autostart()},computed:{viewportHeight:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},viewportWidth:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}},methods:{autostart:function(){var t=this;o()("static/fingers.jpg",function(e){t.start({image:e.toDataURL(),size:{horizontal:3,vertical:3}})},{minWidth:this.viewportWidth,maxWidth:this.viewportWidth,minHeight:this.viewportHeight,maxHeight:this.viewportHeight,canvas:!0})},start:function(){var t;(t=this.$refs.board).start.apply(t,arguments)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(44),s=i.n(n),r=i(47),o=i.n(r),a=i(14),l=i.n(a);e.default={components:{Tile:o.a},data:function(){return{image:null,size:{horizontal:0,vertical:0},tiles:[],tileSize:{width:0,height:0},moves:0,shuffledTiles:!1,farFromBeacon:!1}},watch:{locked:function(t,e){!t&&e&&this.performShuffle()},farFromBeacon:function(t,e){var i=this;t&&!e&&setTimeout(function(){i.farFromBeacon=!1},5e3)}},mounted:function(){},computed:{viewportHeight:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},viewportWidth:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},locked:function(){return this.tiles.some(function(t){return t.isLocked})},frameSize:function(){return{width:this.tileSize.width*this.size.horizontal+"px",height:this.tileSize.height*this.size.vertical+"px"}},userHasMoved:function(){return this.moves>0},currentUser:function(){return this.getQueryParams().player_id},totalTiles:function(){return this.size.horizontal*this.size.vertical},solved:function(){if(!this.tiles.length)return!1;if(this.locked)return!1;for(var t=0;t<this.totalTiles;++t)if(this.tiles[t].styles.order!==this.tiles[t].position)return!1;return!0}},methods:{performShuffle:function(){var t=this;setTimeout(function(){t.shuffleTiles(),t.shuffledTiles=!0},5e3)},getQueryParams:function(t){return(t||document.location.search).replace(/(^\?)/,"").split("&").map(function(t){return t=t.split("="),this[t[0]]=t[1],this}.bind({}))[0]},start:function(t){var e=this,i=t.image,n=t.size;this.size=n,this.image=i;var s=new Image;s.onload=function(){e.tileSize.width=Math.floor(e.viewportHeight/n.horizontal),e.tileSize.height=Math.floor(e.viewportWidth/n.vertical),e.generateTiles()},s.src=i},generateTiles:function(){var t=this;this.tiles=[],l.a.get("http://0.0.0.0:3000/api/captures/by_user/"+this.currentUser).then(function(e){for(var i=e.data.list.map(function(t){return Number(t.tile)}),n=0;n<t.totalTiles;++n)t.tiles.push({styles:{background:0===n?"transparent":"url("+t.image+")",backgroundPositionX:"-"+n%t.size.horizontal*t.tileSize.width+"px",backgroundPositionY:"-"+Math.floor(n/t.size.horizontal)*t.tileSize.height+"px",width:t.tileSize.width+"px",height:t.tileSize.height+"px",order:n},position:n,isEmpty:0===n,isLocked:!i.includes(n)^0===n});t.locked||t.performShuffle()})},shuffleTiles:function(){for(var t=this,e=0,i=5*this.totalTiles;e<i;++e)!function(e,i){var n=t.tiles.find(function(t){return t.isEmpty}),r=t.tiles.filter(function(e){return t.getAdjacentOrders(n).includes(e.styles.order)});t.switchTiles(n,s()(r))}()},unlock:function(t){var e=this,i=new URLSearchParams;i.append("user",this.currentUser),i.append("tile",t.position),i.append("image","otter"),l.a.post("http://0.0.0.0:3000/api/captures",i).then(function(i){console.log(i),"ok"===i.data.status?t.isLocked=!1:e.farFromBeacon=!0})},clickedTile:function(t){var e=this;if(!t.isEmpty){if(t.isLocked)return void this.unlock(t);if(!this.locked){var i=this.tiles.find(function(i){return i.isEmpty&&e.getAdjacentOrders(t).indexOf(i.styles.order)>-1});i&&this.switchTiles(i,t),this.moves+=1}}},switchTiles:function(t,e){var i=[e.styles.order,t.styles.order];t.styles.order=i[0],e.styles.order=i[1]},getAdjacentOrders:function(t){var e=t.styles.order;return[e%this.size.horizontal?e-1:null,(e+1)%this.size.horizontal?e+1:null,e-this.size.horizontal,e+this.size.horizontal]}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["tile"],methods:{onTileClick:function(){this.$emit("clicked",this.tile)}}}},,,,,function(t,e){},function(t,e){},function(t,e){},,,,function(t,e,i){i(41);var n=i(4)(i(34),i(49),null,null);t.exports=n.exports},function(t,e,i){i(40);var n=i(4)(i(35),i(48),null,null);t.exports=n.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"tile",class:{empty:t.tile.isEmpty,locked:t.tile.isLocked},style:t.tile.styles,on:{click:t.onTileClick}})},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"board"},[i("div",{staticClass:"frame-wrapper",style:t.frameSize},[t.solved&&t.userHasMoved?i("p",{staticClass:"win"},[i("span",[t._v("¡Enhorabuena, has completado el puzzle!")]),t._v(" "),i("span",[t._v("Ve a la pantalla de premios para comprobar si tu pincode tiene premio.")])]):t._e(),t._v(" "),t.farFromBeacon?i("p",{staticClass:"win"},[i("span",[t._v("¡Ooops!")]),t._v(" "),i("span",[t._v("Estás fuera del alcance. Para desbloquear la pieza acércate a uno de los puntos de venta de tus bebidas energéticas.")])]):t._e(),t._v(" "),t.locked||t.userHasMoved||t.shuffledTiles?t._e():i("p",{staticClass:"win"},[i("span",[t._v("¡Has desbloqueado todas las piezas!")]),t._v(" "),i("span",[t._v("Ahora se desordenarán y tendrás que volver a colocarlas.")])]),t._v(" "),i("div",{staticClass:"frame",style:t.frameSize},t._l(t.tiles,function(e){return i("Tile",{key:e.position,ref:"tiles",refInFor:!0,attrs:{tile:e},on:{clicked:t.clickedTile}})}))])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("Board",{ref:"board"})],1)},staticRenderFns:[]}}],[32]);
//# sourceMappingURL=app.3bf3772be65ecba02df5.js.map