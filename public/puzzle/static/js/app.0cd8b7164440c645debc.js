webpackJsonp([1],{13:function(e,t,i){i(46);var n=i(4)(i(34),i(55),null,null);e.exports=n.exports},33:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(14),s=i(13),r=i.n(s);n.a.config.productionTip=!1,new n.a({el:"#app",template:"<App/>",components:{App:r.a}})},34:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(51),s=i.n(n),r=i(38),o=i.n(r);t.default={name:"app",components:{Board:s.a},created:function(){this.autostart()},computed:{viewportHeight:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},viewportWidth:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}},methods:{autostart:function(){var e=this;o()("static/fingers.jpg",function(t){e.start({image:t.toDataURL(),size:{horizontal:3,vertical:3}})},{minWidth:this.viewportWidth,maxWidth:this.viewportWidth,minHeight:this.viewportHeight,maxHeight:this.viewportHeight,canvas:!0})},start:function(){var e;(e=this.$refs.board).start.apply(e,arguments)}}}},35:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(37),s=i.n(n),r=i(48),o=i.n(r),a=i(52),l=i.n(a),c=i(15),u=i.n(c),h=i(50),d=(i.n(h),u.a.create({baseURL:""}));t.default={components:{Tile:l.a},data:function(){return{image:null,size:{horizontal:0,vertical:0},tiles:[],tileSize:{width:0,height:0},moves:0,shuffledTiles:!1,farFromBeacon:!1}},watch:{locked:function(e,t){!e&&t&&this.performShuffle()},farFromBeacon:function(e,t){var i=this;e&&!t&&setTimeout(function(){i.farFromBeacon=!1},5e3)}},mounted:function(){},computed:{viewportHeight:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},viewportWidth:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},locked:function(){return this.tiles.some(function(e){return e.isLocked})},frameSize:function(){return{width:this.tileSize.width*this.size.horizontal+"px",height:this.tileSize.height*this.size.vertical+"px"}},userHasMoved:function(){return this.moves>0},currentUser:function(){return this.getQueryParams().player_id},totalTiles:function(){return this.size.horizontal*this.size.vertical},solved:function(){if(!this.tiles.length)return!1;if(this.locked)return!1;for(var e=0;e<this.totalTiles;++e)if(this.tiles[e].styles.order!==this.tiles[e].position)return!1;return!0}},methods:{performShuffle:function(){var e=this;setTimeout(function(){e.shuffleTiles(),e.shuffledTiles=!0},5e3)},getQueryParams:function(e){return(e||document.location.search).replace(/(^\?)/,"").split("&").map(function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0]},backupTiles:function(){localStorage.tiles=s()(this.tiles)},restoreTiles:function(){localStorage.tiles&&(this.tiles=JSON.parse(localStorage.tiles))},start:function(e){var t=this,i=e.image,n=e.size;this.size=n,this.image=i;var s=new Image;s.onload=function(){t.tileSize.width=Math.floor(t.viewportHeight/n.horizontal),t.tileSize.height=Math.floor(t.viewportWidth/n.vertical),t.generateTiles()},s.src=i},generateTiles:function(){var e=this;this.tiles=[],d.get("/api/captures/by_user/"+this.currentUser).then(function(t){for(var i=t.data.list.map(function(e){return Number(e.tile)}),n=0;n<e.totalTiles;++n)e.tiles.push({styles:{background:0===n?"transparent":"url("+e.image+")",backgroundPositionX:"-"+n%e.size.horizontal*e.tileSize.width+"px",backgroundPositionY:"-"+Math.floor(n/e.size.horizontal)*e.tileSize.height+"px",width:e.tileSize.width+"px",height:e.tileSize.height+"px",order:n},position:n,isEmpty:0===n,isLocked:!i.includes(n)^0===n});e.locked||localStorage.tiles?(e.restoreTiles(),e.shuffledTiles=!0):e.performShuffle()})},shuffleTiles:function(){for(var e=this,t=0,i=5*this.totalTiles;t<i;++t)!function(t,i){var n=e.tiles.find(function(e){return e.isEmpty}),s=e.tiles.filter(function(t){return e.getAdjacentOrders(n).includes(t.styles.order)});e.switchTiles(n,o()(s))}()},unlock:function(e){var t=this,i=new URLSearchParams;i.append("user",this.currentUser),i.append("tile",e.position),i.append("image","otter"),d.post("/api/captures",i).then(function(i){console.log(i),"ok"===i.data.status?e.isLocked=!1:t.farFromBeacon=!0})},clickedTile:function(e){var t=this;if(!e.isEmpty){if(e.isLocked)return void this.unlock(e);if(!this.locked){var i=this.tiles.find(function(i){return i.isEmpty&&t.getAdjacentOrders(e).indexOf(i.styles.order)>-1});i&&this.switchTiles(i,e),this.moves+=1,this.backupTiles()}}},switchTiles:function(e,t){var i=[t.styles.order,e.styles.order];e.styles.order=i[0],t.styles.order=i[1]},getAdjacentOrders:function(e){var t=e.styles.order;return[t%this.size.horizontal?t-1:null,(t+1)%this.size.horizontal?t+1:null,t-this.size.horizontal,t+this.size.horizontal]}}}},36:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:["tile"],methods:{onTileClick:function(){this.$emit("clicked",this.tile)}}}},44:function(e,t){},45:function(e,t){},46:function(e,t){},51:function(e,t,i){i(45);var n=i(4)(i(35),i(54),null,null);e.exports=n.exports},52:function(e,t,i){i(44);var n=i(4)(i(36),i(53),null,null);e.exports=n.exports},53:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"tile",class:{empty:e.tile.isEmpty,locked:e.tile.isLocked},style:e.tile.styles,on:{click:e.onTileClick}})},staticRenderFns:[]}},54:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"board"},[i("div",{staticClass:"frame-wrapper",style:e.frameSize},[e.solved&&e.userHasMoved?i("p",{staticClass:"win"},[i("span",[e._v("¡Enhorabuena has completado el puzzle!!")]),e._v(" "),i("span",[e._v("Pulsa en premios para comprobar si te ha tocado una fantástica recompensa. ")])]):e._e(),e._v(" "),e.farFromBeacon?i("p",{staticClass:"win"},[i("span",[e._v("¡Ops estás fuera del alcance!")]),e._v(" "),i("span",[e._v("Para desbloquear la pieza acércate a uno de los puntos de refrescos, neveras y expositores fuera de la zona habitual de refrescos.")])]):e._e(),e._v(" "),e.locked||e.userHasMoved||e.shuffledTiles?e._e():i("p",{staticClass:"win"},[i("span",[e._v("¡Ordena las piezas y podrás ganar una fantástico premio!")])]),e._v(" "),i("div",{staticClass:"frame",style:e.frameSize},e._l(e.tiles,function(t){return i("Tile",{key:t.position,ref:"tiles",refInFor:!0,attrs:{tile:t},on:{clicked:e.clickedTile}})}))])])},staticRenderFns:[]}},55:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("Board",{ref:"board"})],1)},staticRenderFns:[]}}},[33]);
//# sourceMappingURL=app.0cd8b7164440c645debc.js.map